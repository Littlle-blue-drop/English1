# 更新日志

## [0.3.0] - 2025-10-28 🎉

### ✨ 重大更新：数据库集成 + 段落测评 + 学习记录

#### 🗄️ 数据库集成（Supabase）
- ✅ **Supabase PostgreSQL 数据库**：从内存存储迁移到真实数据库
- ✅ **用户数据持久化**：注册的用户数据永久保存
- ✅ **练习记录持久化**：所有练习记录自动保存到数据库
- ✅ **兼容模式**：未配置 Supabase 时自动回退到内存存储
- ✅ **自动化表结构**：包含触发器、索引、统计自动更新

#### 📄 段落朗读测评（新功能）
- ✅ **段落测评页面** (`/paragraph`)：支持篇章级别的朗读评测
- ✅ **精选段落库**：5篇经典英语段落（阅读、科技、环保、教育、运动）
- ✅ **自定义段落**：支持用户输入任意长度的段落
- ✅ **`read_chapter` 模式**：使用讯飞篇章评测引擎
- ✅ **自动保存记录**：评测完成后自动保存到数据库

#### 📊 学习记录系统
- ✅ **学习记录页面** (`/history`)：查看所有练习历史
- ✅ **统计数据展示**：
  - 总练习次数
  - 总学习时长
  - 平均分数 / 最高分数
  - 分类统计（单词/句子/段落）
- ✅ **类型筛选**：按类型查看练习记录
- ✅ **智能时间显示**：今天、昨天、N天前
- ✅ **详细评分展示**：准确度、流畅度、完整度

#### 🔄 自动保存功能
- ✅ **单词测评**：完成评测后自动保存记录
- ✅ **句子测评**：完成评测后自动保存记录
- ✅ **段落测评**：完成评测后自动保存记录
- ✅ **录音时长统计**：自动记录每次练习的时长

#### 🛠️ API 端点
- ✅ `POST /api/practice` - 保存练习记录
- ✅ `GET /api/practice` - 查询练习记录列表（支持类型筛选、分页）
- ✅ `GET /api/practice/stats` - 获取学习统计数据

#### 📦 新增文件
- `lib/supabase.ts` - Supabase 客户端配置
- `supabase-schema.sql` - 数据库表结构 SQL
- `SUPABASE_SETUP.md` - Supabase 配置指南
- `app/paragraph/page.tsx` - 段落测评页面
- `app/history/page.tsx` - 学习记录页面
- `app/api/practice/route.ts` - 练习记录 API
- `app/api/practice/stats/route.ts` - 统计数据 API

#### 🔧 重构优化
- 🔄 `lib/auth.ts` - 支持 Supabase 数据库查询
- 🔄 `app/word/page.tsx` - 添加自动保存功能
- 🔄 `app/sentence/page.tsx` - 添加自动保存功能
- 🔄 `app/page.tsx` - 添加段落测评和学习记录入口

#### 📚 文档更新
- ✅ Supabase 设置完整指南
- ✅ 数据库表结构说明
- ✅ 环境变量配置更新

### 🎯 使用流程
1. **配置 Supabase**：按照 `SUPABASE_SETUP.md` 设置数据库
2. **注册/登录**：创建账号或登录现有账号
3. **开始练习**：单词、句子或段落测评
4. **自动保存**：评测结果自动保存到数据库
5. **查看记录**：在学习记录页面查看历史和统计

### 📈 下一步计划
- [ ] 学习趋势图表（Chart.js）
- [ ] 错题本功能
- [ ] 每日/每周目标设置
- [ ] AI 发音建议（GPT集成）
- [ ] 排行榜系统
- [ ] 移动端优化

---

## [0.2.0] - 2025-10-27

### ✨ 新增功能

#### 用户认证系统
- ✅ **邮箱注册**：用户可以使用邮箱注册新账号
- ✅ **邮箱登录**：支持邮箱和密码登录
- ✅ **会话管理**：JWT认证，7天会话有效期
- ✅ **用户菜单**：登录后显示用户信息和头像
- ✅ **安全登出**：清除会话，退出登录

#### 页面
- ✅ 登录页面 (`/login`)
- ✅ 注册页面 (`/register`)
- ✅ 主页更新（添加用户菜单）

#### API端点
- ✅ `POST /api/auth/register` - 用户注册
- ✅ `POST /api/auth/login` - 用户登录
- ✅ `POST /api/auth/logout` - 用户登出
- ✅ `GET /api/auth/me` - 获取当前用户信息

#### 安全特性
- ✅ bcrypt密码加密（10 rounds）
- ✅ JWT token认证
- ✅ HttpOnly Cookie（防XSS）
- ✅ SameSite属性（防CSRF）
- ✅ 邮箱格式验证
- ✅ 密码长度验证（最少6个字符）
- ✅ 重复邮箱检测

#### UI组件
- ✅ `UserMenu` - 用户下拉菜单组件
- ✅ `AuthProvider` - 认证状态管理组件
- ✅ 响应式登录表单
- ✅ 响应式注册表单
- ✅ 加载状态显示
- ✅ 友好的错误提示

#### 文档
- ✅ `LOGIN_GUIDE.md` - 登录功能详细使用指南
- ✅ `QUICK_START_LOGIN.md` - 快速开始指南
- ✅ `AUTH_IMPLEMENTATION.md` - 认证系统实现总览
- ✅ `TEST_SCENARIOS.md` - 完整测试场景
- ✅ 更新 `README.md`，添加登录功能说明

### 🔧 技术改进

#### 依赖包
- ✅ 新增 `bcryptjs` - 密码加密
- ✅ 新增 `jsonwebtoken` - JWT认证
- ✅ 新增 `cookie` - Cookie管理
- ✅ 新增对应的TypeScript类型定义

#### 工具函数
- ✅ `lib/auth.ts` - 服务端认证逻辑
- ✅ `lib/auth-client.ts` - 客户端认证工具

#### 环境变量
- ✅ 新增 `JWT_SECRET` 配置项
- ✅ 更新 `env.example`

### 🎨 UI/UX改进
- ✅ 现代化的登录/注册页面设计
- ✅ 流畅的页面过渡动画
- ✅ 清晰的表单验证提示
- ✅ 友好的用户菜单交互
- ✅ 完全响应式设计
- ✅ 优雅的错误处理

### 📝 代码质量
- ✅ TypeScript类型安全
- ✅ 无linter错误
- ✅ 清晰的代码注释
- ✅ 模块化设计
- ✅ 可复用的组件

### 🧪 测试覆盖
- ✅ 20个完整测试场景
- ✅ 功能测试清单
- ✅ 边界测试清单
- ✅ 安全测试清单
- ✅ UI/UX测试清单

### ⚠️ 已知限制

1. **数据存储**
   - 当前使用内存存储
   - 重启服务器后数据丢失
   - 需要集成真实数据库（下一版本）

2. **功能限制**
   - 无邮箱验证
   - 无密码重置
   - 无用户资料编辑
   - 无学习记录保存

### 🔮 下一步计划

#### v0.3.0（计划）
- [ ] 集成MongoDB/PostgreSQL数据库
- [ ] 添加邮箱验证功能
- [ ] 实现密码重置功能
- [ ] 用户资料编辑
- [ ] 访问控制和路由保护

#### v0.4.0（计划）
- [ ] 学习历史记录
- [ ] 成绩统计和分析
- [ ] 学习进度追踪
- [ ] 成就系统

#### v0.5.0（计划）
- [ ] 社交登录（Google、GitHub）
- [ ] 多语言支持
- [ ] 移动端优化
- [ ] PWA支持

---

## [0.1.0] - 2025-10-14

### 初始版本

#### 核心功能
- ✅ 单词跟读评测
- ✅ 句子跟读评测
- ✅ 实时音频录制
- ✅ 多维度评分系统
- ✅ 错误定位和分析

#### 技术实现
- ✅ Next.js 14框架
- ✅ TypeScript
- ✅ Tailwind CSS
- ✅ 科大讯飞语音评测API
- ✅ WebSocket通信
- ✅ Web Audio API

#### 组件
- ✅ `RecordButton` - 录音按钮
- ✅ `ScoreDisplay` - 评分显示
- ✅ 单词跟读页面
- ✅ 句子跟读页面
- ✅ 首页

#### 文档
- ✅ README.md
- ✅ PROJECT_OVERVIEW.md
- ✅ QUICKSTART.md
- ✅ DEPLOYMENT.md
- ✅ TROUBLESHOOTING.md

---

## 版本说明

### 语义化版本
本项目遵循[语义化版本](https://semver.org/lang/zh-CN/)规范：

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 版本状态
- **稳定版**：通过完整测试，可用于生产环境
- **测试版**：功能完整，需要进一步测试
- **开发版**：正在开发中的版本

当前版本 **v0.2.0** 为 **测试版**：
- ✅ 功能完整
- ⚠️ 使用内存存储（不适合生产环境）
- 📝 建议在开发和测试环境使用

---

## 贡献指南

如果你想为项目做出贡献：

1. Fork本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 提交Pull Request

---

## 问题反馈

如果发现bug或有功能建议，请在GitHub上提交Issue。

---

**维护者**: AI语音评测系统开发团队
**最后更新**: 2025-10-28



