# 📋 项目概览

## 项目信息

**项目名称**：AI语音评测系统 (MVP版本)  
**技术栈**：Next.js 14 + TypeScript + Tailwind CSS  
**部署平台**：Vercel  
**API提供商**：科大讯飞语音评测（流式版）  
**开发状态**：✅ MVP完成

## 核心功能

### 1. 单词跟读 (read_word)
- ✅ 单词发音评测
- ✅ 音节级别分析
- ✅ 重读检测
- ✅ 增漏读识别
- ✅ 实时评分反馈

### 2. 句子跟读 (read_sentence)
- ✅ 多维度评分（准确度、流畅度、标准度、完整度）
- ✅ 单词级错误定位
- ✅ 乱读智能检测
- ✅ 详细评分报告

## 技术架构

```
┌─────────────────────────────────────────┐
│           用户界面 (Next.js)              │
│  ┌──────────┐  ┌──────────┐            │
│  │ 单词跟读  │  │ 句子跟读  │            │
│  └──────────┘  └──────────┘            │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│          录音模块 (Web Audio API)        │
│  - 16kHz 采样率                          │
│  - 16bit 位深                            │
│  - 单声道                                │
│  - 实时流式传输                          │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│      WebSocket 客户端 (讯飞API)          │
│  - HMAC-SHA256 签名鉴权                  │
│  - 流式音频上传                          │
│  - 实时结果接收                          │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│         讯飞语音评测服务                  │
│  - 语音识别                              │
│  - 发音评测                              │
│  - 错误检测                              │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│        XML 结果解析 & 展示               │
│  - 总分计算                              │
│  - 维度分析                              │
│  - 错误标注                              │
└─────────────────────────────────────────┘
```

## 目录结构

```
voice-evaluation-mvp/
├── app/                          # Next.js App Router
│   ├── page.tsx                 # 首页 - 功能导航
│   ├── word/                    # 单词跟读模块
│   │   └── page.tsx            # 单词评测页面
│   ├── sentence/                # 句子跟读模块
│   │   └── page.tsx            # 句子评测页面
│   ├── layout.tsx               # 根布局
│   └── globals.css              # 全局样式
│
├── components/                   # React组件
│   ├── RecordButton.tsx         # 录音控制按钮
│   │   ├── 录音状态显示
│   │   ├── 录音计时器
│   │   └── 处理状态反馈
│   └── ScoreDisplay.tsx         # 评分结果展示
│       ├── 总分显示
│       ├── 维度评分
│       ├── 单词级分析
│       └── 错误标注
│
├── lib/                         # 核心功能库
│   ├── xfyun-client.ts         # 讯飞WebSocket客户端
│   │   ├── 鉴权URL生成
│   │   ├── WebSocket连接管理
│   │   ├── 音频帧发送
│   │   └── 结果接收处理
│   ├── audio-recorder.ts        # Web Audio录音器
│   │   ├── 麦克风初始化
│   │   ├── 实时音频采集
│   │   ├── PCM格式转换
│   │   └── 资源管理
│   └── xml-parser.ts            # XML结果解析器
│       ├── Base64解码
│       ├── XML解析
│       ├── 评分提取
│       └── 错误信息解析
│
├── public/                      # 静态资源
│
├── 配置文件
│   ├── package.json            # 项目依赖
│   ├── next.config.js          # Next.js配置
│   ├── tsconfig.json           # TypeScript配置
│   ├── tailwind.config.ts      # Tailwind CSS配置
│   ├── postcss.config.js       # PostCSS配置
│   ├── vercel.json             # Vercel部署配置
│   └── env.example             # 环境变量模板
│
└── 文档
    ├── README.md               # 完整项目文档
    ├── QUICKSTART.md           # 快速启动指南
    ├── DEPLOYMENT.md           # 部署详细说明
    └── PROJECT_OVERVIEW.md     # 本文档
```

## 核心模块详解

### 1. XFYun Client（讯飞客户端）

**职责**：
- WebSocket连接管理
- HMAC-SHA256鉴权
- 流式音频上传
- 评测结果接收

**关键方法**：
```typescript
class XFYunClient {
  generateAuthUrl()      // 生成鉴权URL
  connect()              // 建立WebSocket连接
  sendAudio()            // 发送音频数据
  onMessage()            // 监听评测结果
  close()                // 关闭连接
}
```

### 2. Audio Recorder（录音器）

**职责**：
- 麦克风权限申请
- 实时音频采集
- Float32转Int16 PCM
- 音频流管理

**关键方法**：
```typescript
class AudioRecorder {
  init()                 // 初始化录音器
  start()                // 开始录音
  stop()                 // 停止录音
  release()              // 释放资源
  float32ToInt16()       // 格式转换
}
```

### 3. XML Parser（结果解析器）

**职责**：
- Base64解码
- XML解析
- 评分数据提取
- 错误信息解析

**关键方法**：
```typescript
class XMLParser {
  parseResult()          // 解析评测结果
  getScoreLevel()        // 获取评分等级
  getErrorDescription()  // 获取错误描述
}
```

## 数据流程

### 录音评测流程

```
1. 用户点击录音按钮
   ↓
2. 申请麦克风权限
   ↓
3. 初始化AudioContext (16kHz)
   ↓
4. 建立WebSocket连接（鉴权）
   ↓
5. 发送第一帧（参数配置）
   {
     category: 'read_word',
     text: '[word]\napple',
     ent: 'en_vip'
   }
   ↓
6. 开始录音，实时采集音频
   ↓
7. 流式发送音频帧
   - 首帧：aus=1, status=1
   - 中间帧：aus=2, status=1
   - 尾帧：aus=4, status=2
   ↓
8. 服务端实时评测
   ↓
9. 接收评测结果（status=2）
   ↓
10. 解析XML结果
    ↓
11. 展示评分界面
```

### 评分计算公式

**单词评测**：
```
总分 = 模型回归分数
包含：音节准确度、重读检测
```

**句子评测（成人）**：
```
总分 = (准确度 × 0.6 + 流畅度 × 0.3 + 标准度 × 0.1) × 完整度 / 100

准确度：单词发音准确性（0-100）
流畅度：语速、停顿合理性（0-100）
标准度：母语发音习惯（0-100）
完整度：内容完整程度（0-100）
```

## API参数配置

### 业务参数（business）

| 参数 | 值 | 说明 |
|------|-----|------|
| sub | ise | 服务类型（开放评测） |
| ent | en_vip | 英文评测引擎 |
| category | read_word / read_sentence | 题型 |
| aue | raw | 音频格式（PCM） |
| auf | audio/L16;rate=16000 | 采样率 |
| rst | entirety | 完整结果 |
| ise_unite | 1 | 结果控制 |
| extra_ability | multi_dimension | 多维度分析 |

### 试题格式

**单词**：
```
[word]
apple
```

**句子**：
```
[content]
Hello, how are you today?
```

## 性能指标

### 音频参数
- **采样率**：16kHz
- **位深**：16bit
- **声道**：单声道
- **帧大小**：1280字节 (每40ms)
- **最大帧**：19200字节 (base64后<26000字节)

### API限制
- **并发连接**：50路（默认）
- **会话时长**：最长5分钟
- **推荐时长**：3分钟以内
- **响应延迟**：实时流式（<100ms）

### 性能优化
- ✅ 流式传输，无需等待完整音频
- ✅ 客户端音频处理，降低带宽
- ✅ Base64编码，WebSocket文本传输
- ✅ 错误检测，乱读拒识

## 浏览器兼容性

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 60+ | ✅ 完全支持 |
| Edge | 79+ | ✅ 完全支持 |
| Safari | 14+ | ✅ 完全支持 |
| Firefox | 55+ | ✅ 完全支持 |
| IE | 任何版本 | ❌ 不支持 |

**必需API**：
- Web Audio API
- WebSocket
- MediaDevices.getUserMedia
- Promise/Async

## 安全考虑

### ⚠️ 当前安全问题

1. **API密钥暴露**
   - 密钥在客户端可见
   - 可通过浏览器控制台查看
   - 存在滥用风险

### ✅ 改进建议

1. **使用服务端代理**
```typescript
// app/api/evaluate/route.ts
export async function POST(request) {
  // 在服务端处理API密钥
  const apiKey = process.env.XFYUN_API_KEY;
  // ...
}
```

2. **添加用户认证**
- 使用 NextAuth.js
- 限制匿名访问
- 记录使用日志

3. **实施速率限制**
- Redis存储请求计数
- IP级别限流
- 用户级别配额

## 扩展功能规划

### Phase 2（功能增强）
- [ ] 篇章朗读（read_chapter）
- [ ] 音频波形可视化
- [ ] 发音对比播放
- [ ] 学习进度追踪
- [ ] 历史记录查看

### Phase 3（高级功能）
- [ ] 中文普通话评测
- [ ] 情景反应题
- [ ] 看图说话
- [ ] AI智能纠错建议
- [ ] 个性化学习路径

### Phase 4（平台化）
- [ ] 用户系统
- [ ] 课程管理
- [ ] 班级管理
- [ ] 数据分析看板
- [ ] API开放平台

## 技术债务

### 需要改进的地方

1. **错误处理**
   - 更详细的错误分类
   - 用户友好的错误提示
   - 自动重试机制

2. **测试覆盖**
   - 单元测试
   - 集成测试
   - E2E测试

3. **代码优化**
   - 组件拆分（过大的页面组件）
   - 自定义Hooks提取
   - 状态管理优化

4. **性能优化**
   - 代码分割
   - 懒加载
   - 缓存策略

5. **无障碍性**
   - ARIA标签
   - 键盘导航
   - 屏幕阅读器支持

## 成本估算

### 开发成本
- **时间**：约2-3天（MVP）
- **人力**：1名全栈开发者

### 运营成本（月）

**Vercel（免费套餐）**：
- 100 GB 带宽
- 100 GB-Hrs 函数执行时间
- ✅ 个人项目免费

**讯飞API**：
- 按调用次数计费
- 具体价格见官网
- 新用户可能有免费额度

**预估（100用户/天）**：
- 每天约100次评测
- 月均3000次
- 成本：¥0-100（视套餐而定）

## 文档清单

- ✅ **README.md** - 完整项目文档
- ✅ **QUICKSTART.md** - 5分钟快速启动
- ✅ **DEPLOYMENT.md** - 详细部署指南
- ✅ **PROJECT_OVERVIEW.md** - 本概览文档
- ✅ **env.example** - 环境变量模板

## 联系方式

- **项目仓库**：[GitHub链接]
- **问题反馈**：GitHub Issues
- **文档更新**：欢迎提交PR

---

**最后更新**：2025年
**版本**：v1.0.0 (MVP)
**状态**：✅ 生产就绪

