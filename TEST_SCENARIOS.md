# 测试场景

## 🧪 测试用例

### 测试场景 1：成功注册新用户

**步骤：**
1. 访问 http://localhost:3000
2. 点击右上角"注册"按钮
3. 填写表单：
   - 姓名：张三
   - 邮箱：zhangsan@example.com
   - 密码：123456
   - 确认密码：123456
4. 点击"注册"按钮

**预期结果：**
- ✅ 注册成功
- ✅ 自动登录
- ✅ 跳转到首页
- ✅ 右上角显示用户名"张三"
- ✅ 首页显示"👋 欢迎回来，张三！"

---

### 测试场景 2：邮箱格式验证

**步骤：**
1. 访问注册页面
2. 填写无效邮箱格式：
   - 邮箱：invalid-email
3. 点击"注册"按钮

**预期结果：**
- ✅ 浏览器显示"请输入有效的邮箱地址"提示
- ❌ 不发送请求到服务器

---

### 测试场景 3：密码长度验证

**步骤：**
1. 访问注册页面
2. 填写短密码：
   - 密码：12345（少于6个字符）
3. 点击"注册"按钮

**预期结果：**
- ✅ 显示错误："密码至少需要6个字符"

---

### 测试场景 4：密码确认不匹配

**步骤：**
1. 访问注册页面
2. 填写不匹配的密码：
   - 密码：123456
   - 确认密码：654321
3. 点击"注册"按钮

**预期结果：**
- ✅ 显示错误："两次输入的密码不一致"

---

### 测试场景 5：重复邮箱注册

**前置条件：** 已存在用户 zhangsan@example.com

**步骤：**
1. 访问注册页面
2. 使用已注册的邮箱：
   - 邮箱：zhangsan@example.com
3. 点击"注册"按钮

**预期结果：**
- ✅ 显示错误："该邮箱已被注册"

---

### 测试场景 6：成功登录

**前置条件：** 已注册用户 zhangsan@example.com

**步骤：**
1. 访问登录页面
2. 填写正确的凭证：
   - 邮箱：zhangsan@example.com
   - 密码：123456
3. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功
- ✅ 跳转到首页
- ✅ 显示用户信息

---

### 测试场景 7：错误的邮箱

**步骤：**
1. 访问登录页面
2. 填写不存在的邮箱：
   - 邮箱：notexist@example.com
   - 密码：123456
3. 点击"登录"按钮

**预期结果：**
- ✅ 显示错误："邮箱或密码错误"
- ✅ 保持在登录页面

---

### 测试场景 8：错误的密码

**前置条件：** 已注册用户 zhangsan@example.com

**步骤：**
1. 访问登录页面
2. 填写错误的密码：
   - 邮箱：zhangsan@example.com
   - 密码：wrongpassword
3. 点击"登录"按钮

**预期结果：**
- ✅ 显示错误："邮箱或密码错误"
- ✅ 保持在登录页面

---

### 测试场景 9：会话持久性

**前置条件：** 已登录

**步骤：**
1. 登录成功后
2. 刷新页面（F5）

**预期结果：**
- ✅ 用户仍然保持登录状态
- ✅ 用户信息正确显示

---

### 测试场景 10：用户菜单交互

**前置条件：** 已登录

**步骤：**
1. 点击右上角用户头像/姓名
2. 查看下拉菜单

**预期结果：**
- ✅ 显示下拉菜单
- ✅ 显示用户姓名
- ✅ 显示用户邮箱
- ✅ 显示"登出"按钮

---

### 测试场景 11：成功登出

**前置条件：** 已登录

**步骤：**
1. 点击用户头像/姓名
2. 点击"登出"按钮

**预期结果：**
- ✅ 登出成功
- ✅ 返回未登录状态
- ✅ 右上角显示"登录"和"注册"按钮
- ✅ 欢迎消息消失

---

### 测试场景 12：登出后访问保护页面

**步骤：**
1. 登出后
2. 刷新页面

**预期结果：**
- ✅ 用户保持登出状态
- ✅ 不会自动登录

---

### 测试场景 13：空字段验证（注册）

**步骤：**
1. 访问注册页面
2. 留空必填字段
3. 点击"注册"按钮

**预期结果：**
- ✅ 浏览器显示"请填写此字段"提示
- ❌ 不发送请求

---

### 测试场景 14：空字段验证（登录）

**步骤：**
1. 访问登录页面
2. 留空邮箱或密码
3. 点击"登录"按钮

**预期结果：**
- ✅ 浏览器显示"请填写此字段"提示
- ❌ 不发送请求

---

### 测试场景 15：加载状态

**步骤：**
1. 填写登录表单
2. 点击"登录"按钮
3. 观察按钮状态

**预期结果：**
- ✅ 按钮文字变为"登录中..."
- ✅ 按钮变为禁用状态
- ✅ 请求完成后恢复正常

---

### 测试场景 16：页面导航

**步骤：**
1. 从注册页面点击"立即登录"
2. 从登录页面点击"立即注册"
3. 点击"返回首页"

**预期结果：**
- ✅ 正确跳转到对应页面
- ✅ 不丢失表单数据前的状态

---

### 测试场景 17：响应式设计（移动端）

**步骤：**
1. 打开浏览器开发者工具
2. 切换到移动设备模拟器
3. 访问登录/注册页面

**预期结果：**
- ✅ 页面正确适配移动端
- ✅ 所有元素可点击
- ✅ 表单输入正常
- ✅ 按钮大小合适

---

### 测试场景 18：API 直接调用（注册）

**步骤：**
使用 curl 或 Postman：
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456",
    "name": "Test User"
  }'
```

**预期结果：**
- ✅ 返回 200 状态码
- ✅ 返回用户信息（不含密码）
- ✅ 设置 auth-token Cookie

---

### 测试场景 19：API 直接调用（登录）

**步骤：**
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456"
  }'
```

**预期结果：**
- ✅ 返回 200 状态码
- ✅ 返回用户信息
- ✅ 设置 auth-token Cookie

---

### 测试场景 20：API 直接调用（获取当前用户）

**前置条件：** 已获取 auth-token

**步骤：**
```bash
curl http://localhost:3000/api/auth/me \
  -H "Cookie: auth-token=YOUR_TOKEN_HERE"
```

**预期结果：**
- ✅ 返回 200 状态码
- ✅ 返回当前用户信息

---

## 🔍 测试检查清单

### 功能性测试
- [x] 用户可以成功注册
- [x] 用户可以成功登录
- [x] 用户可以成功登出
- [x] 会话正确持久化
- [x] 重复邮箱被正确拒绝

### 验证测试
- [x] 邮箱格式验证
- [x] 密码长度验证
- [x] 密码确认匹配验证
- [x] 必填字段验证

### 安全测试
- [x] 密码被正确加密
- [x] 不返回密码字段
- [x] Cookie 设置正确
- [x] JWT token 有效

### UI/UX 测试
- [x] 加载状态显示
- [x] 错误提示友好
- [x] 页面导航流畅
- [x] 响应式设计正常

### API 测试
- [x] 注册 API 正常工作
- [x] 登录 API 正常工作
- [x] 登出 API 正常工作
- [x] 获取用户 API 正常工作

## 🐛 已知问题

### 当前限制
1. **数据持久性**：使用内存存储，重启后数据丢失
   - **解决方案**：集成真实数据库

2. **没有邮箱验证**：注册后立即可用
   - **解决方案**：添加邮箱验证流程

3. **没有密码重置**：忘记密码无法恢复
   - **解决方案**：实现密码重置功能

4. **没有速率限制**：可能被暴力破解
   - **解决方案**：添加请求频率限制

## 💡 测试提示

### 快速测试命令

**创建测试用户：**
```bash
# 在浏览器控制台执行
fetch('/api/auth/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'test@example.com',
    password: '123456',
    name: 'Test User'
  })
}).then(r => r.json()).then(console.log);
```

**测试登录：**
```bash
fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'test@example.com',
    password: '123456'
  })
}).then(r => r.json()).then(console.log);
```

**获取当前用户：**
```bash
fetch('/api/auth/me')
  .then(r => r.json())
  .then(console.log);
```

### 浏览器开发者工具检查

1. **检查 Cookie：**
   - Application → Cookies → http://localhost:3000
   - 查找 `auth-token`

2. **检查网络请求：**
   - Network → 筛选 `auth`
   - 查看请求和响应

3. **检查控制台错误：**
   - Console → 查看是否有错误

## 📊 测试覆盖率目标

- ✅ 功能测试：100%
- ✅ 边界测试：100%
- ✅ 安全测试：100%
- ✅ UI测试：100%
- ✅ API测试：100%

## 🎯 性能测试

### 响应时间目标
- 注册：< 500ms
- 登录：< 300ms
- 登出：< 100ms
- 获取用户：< 100ms

### 并发测试
- 建议使用 Apache Bench 或 k6 进行负载测试

---

**测试环境：** 开发环境（localhost:3000）
**浏览器兼容：** Chrome、Firefox、Safari、Edge
**移动端：** iOS Safari、Android Chrome



